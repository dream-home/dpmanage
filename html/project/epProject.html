<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>账户基本信息</title>
		<!-- jqgrid样式 -->
		<link rel="stylesheet" href="/enjoyRedEnvelopeManager/css/ui.jqgrid.css" />
		<!-- bootstrap styles -->
		<link rel="stylesheet" href="/enjoyRedEnvelopeManager/css/bootstrap.min.css" />
		<!-- basic styles -->
		<link rel="stylesheet" href="/enjoyRedEnvelopeManager/css/ace.min.css" />
		<!-- 图标样式 -->
		<link rel="stylesheet" href="/enjoyRedEnvelopeManager/css/font-awesome.min.css" />
		<!-- 弹出框from样式 -->
		<link rel="stylesheet" href="/enjoyRedEnvelopeManager/css/grid_form.css" />
		<!-- 导入选项卡样式 -->
		<link rel="stylesheet" href="/enjoyRedEnvelopeManager/css/grid_tab.css" />
		<link rel="stylesheet"  href="/enjoyRedEnvelopeManager/css/inputstyle.css"  />
		<link rel="stylesheet" type="text/css" href="/enjoyRedEnvelopeManager/css/wangEditor.min.css">
   
		
		
			<style type="text/css">
			
			
			.resizer {
				overflow: hidden;
			}
			
			.resizer.have-img button.ok {
				display: inline-block;
			}
			
			.resizer.have-img .inner {
				display: block;
			}
			
			.inner {
				width: 100%;
				position: relative;
				font-size: 0;
				overflow: hidden;
				display: none;
			}
			
			img {
				width: 100%;
			}
			
			.frames {
				position: absolute;
				top: 0;
				left: 0;
				border: 1px solid black;
				cursor: move;
				outline: rgba(0, 0, 0, 0.6) solid 10000px;
			}
			
			button.ok {
				float: right;
				margin-left: 5px;
				display: none;
			}
			
			canvas {
				max-width: 100%;
				margin: auto;
				display: block;
			}
			#editor-trigger {
            	height: 120px;
	            /*max-height: 500px;*/
	        }
	        .container {
	            width: 100%;
	            margin: 0 auto;
	            position: relative;
	        }
		</style>
		
		<script type="text/javascript" src="/enjoyRedEnvelopeManager/js/jquery-1.10.2.min.js"></script>
    	<script type="text/javascript" src="/enjoyRedEnvelopeManager/js/wangEditor.js"></script>

		<!-- 按 jquery-bootstrap-ace 顺序-->
		<script src="/enjoyRedEnvelopeManager/js/jquery-2.0.3.min.js"></script>
		<!-- jqgrid js -->
		<script src="/enjoyRedEnvelopeManager/js/jqGrid/jquery.jqGrid.min.js"></script>
		<script src="/enjoyRedEnvelopeManager/js/jqGrid/i18n/grid.locale-en.js"></script>
		<!-- bootstrap js -->
		<script src="/enjoyRedEnvelopeManager/js/bootstrap.min.js"></script>
		<script src="/enjoyRedEnvelopeManager/js/ace.min.js"></script>
		<!--验证js-->
		<script src="/enjoyRedEnvelopeManager/js/Validform_v5.3.2_min.js"></script>
		<!--grid事件机制-->
		<script src="/enjoyRedEnvelopeManager/js/grid.js"></script>
		<!--
        	引进路径
        -->
        <script type="text/javascript" src="/enjoyRedEnvelopeManager/js/basepath.js" ></script>
        <!--cookiejs-->
		<script src="/enjoyRedEnvelopeManager/js/jquery-cookie.js"></script>

		<script>
		var token = sessionStorage.getItem("token");
		var grid_user= "#grid_user";
		var grid_pager_user = "#grid_pager_user";
		$(function() {
					var date = new Date();
					var now = date.getFullYear()+"-"+(date.getMonth()+1)+"-"+((date.getDate())<=9?("0"+date.getDate()):date.getDate());	
					$.autoByWindow(grid_user);
					/*var per = {
						status:0,
						token:sessionStorage.getItem("token")
					}
					
					$.jqGrid(grid_user, $base_path + 'manage/goods/list',per, colNames_user, fd_user, grid_pager_user, "商品列表", gridUserComplete,true,true,15);*/
					/*url传参*/
					
					var todData = {
						status:1,
						token:sessionStorage.getItem("token")
					}
					
					$.jqGrid(grid_user, $base_path + 'manage/goods/list?goodsType=0',todData, colNames_user, fd_user, grid_pager_user, "商品列表", gridUserComplete,true,true,15);
					$("#t_grid_user").append($("#grid_user_tbar").html());
					
					$.navGrid(grid_user, grid_pager_user);
					$.navButtonAdd(grid_user, grid_pager_user, 'icon-plus-sign purple', '<font color="purple">添加</font>', '添加', add);
					//uploadBase("mu_Input","icon","adImg");
					$.navButtonAdd(grid_user, grid_pager_user, 'icon-trash red', '<font color="red">商品下架</font>', '商品下架', beforeDel);
					/*$("#datestart").val(now);		
					$("#dateend").val(now);
					*/
					//_search();
					
					var page = {
						pageNo:1,
						pageSize:30
					}
					
					$.ajax({
			        type: 'get',
			        url: $base_path +"manage/goods/animalsGoods/list",
			        beforeSend: function(request) {
                        request.setRequestHeader("token", sessionStorage.getItem("token"));
               		},
               		data:page,
			        success: function(data) {
			        	if(data.code == 200){
			        		
			        		
			        		var str1 = "<option  value=''>全部</option>";
			        		var str2 = "";
			        		var str = "";
			        		for(i in data.result.rows){
			        			
			        			if(i==0){
			        				str+="<option value='"+data.result.rows[i].id+"'>"+ data.result.rows[i].name+"</option>";	
			        			}else{
			        				str+="<option value='"+data.result.rows[i].id+"'>"+ data.result.rows[i].name+"</option>";
			        			}
			        			
			        			if("EP兑换"==data.result.rows[i].name){
			        				//str2="<option  selected='selected'  value='"+data.result.rows[i].id+"'>"+ data.result.rows[i].name+"</option>";
			        				
			        				$("#goodsSortId2").html(data.result.rows[i].id);  
			        			}
			        			
			        			
			        		}
						    $("#goodsSortId").html(str2+str);
						    
						    
						    $("#goodsSorts").html(str1+str);
						    
						    
			        	}else if(data.code == 1403){
			        		overTime();
			        	}else{
			        		//alert(data.msg);
			        	}
			        },
			        
			        })
					
					
					
					
					
					
					
					
					
					
					$(".checkform").Validform({
						tiptype:function(msg, o, cssctl){
							var objtip = $("#msgspan");
							cssctl(objtip,o.type);
							objtip.text(msg);
						},
						callback: function(){
							edit_submit();
							return false;
						}
					});
					//匿名form表单
					$("#uploadImg").click(function(){					
						/*alert(JSON.stringify(new FormData($('#edit_user')[0])));*/
						$.ajax({
						    url: $base_path+"manage/image/upload",
						    type: 'POST',
						    cache: false,
						    data: new FormData($('#edit_user')[0]),
						    beforeSend: function(request) {
		                        request.setRequestHeader("token", sessionStorage.getItem("token"));
		               		},
						    processData: false,
						    contentType: false
						}).done(function(res) {
							if(res.code==200){
								$("#icon").attr("src",sessionStorage.getItem("imgUrl")+res.result);
								$("#adImg").val(res.result);
								
							}else if(res.code==1403){
								overTime();
							}else{
								//alert(res.msg);
							}
							
							//alert($("#mu_img").attr("src"));
							//alert(res.result);
						}).fail(function(res) {
							
						});
	
					})
					
					
				
			});
			
			var colNames_user = ['ID', 'icon','图片', '商品名称', '商品介绍','商品属性','商品价格','商品库存', '发布时间','备注','操作'];
			var fd_user = [
				{name:'id', index:'id', width:60, key: true,hidden:true},
				{name:'icon', index:'icon', hidden:true},
				{name:'image', index:'image', width:60,formatter:getStatus,align:'center',hidden:true},
				{name:'name', index:'name', align: 'center', width:60},
				{name:'detail', index:'detail', align: 'center', width:300,hidden:true},
				{name:'goodsSortId', index:'goodsSortId', align: 'center', hidden:true,width:60},
				{name:'price', index:'price', align: 'center', width:60},
				{name:'stock', index:'stock', align: 'center', width:60},
				{name:'createTime', index:'createTime', align: 'center',width:60, sorttype:"date"},
				{name:'remark', index:'remark', width:60, align: 'center'},
				{name:'func',index:'func', width:40, align: 'center'}
			];
			
			function getSwitch(v){
				
				if(v =='0'){
					return "否";
				}else if(v =='1'){
					return "是";
				}
				
				
			}
			
			
			
			function getStatus(v,o,row){
				
				return "";
				/*if(row.icon == ""){
					return "";
				}else{
					return "<img style='width:30px;height=30px;' src='"+row.icon+"'>";
				}*/
			}
			
			function gridUserComplete(){
				var ids = $(grid_user).jqGrid('getDataIDs');
				for (var i = 0; i < ids.length; i++) {
					var paramId = ids[i];
					
					var paramIds = ids[i];
					var paramIds = ids[i+1];
					var count  =  i;
					count++;
					if(ids.length == count){
						//alert("dd");
						paramIds = ids[i];
					}
					
					var rowData = $(grid_user).getRowData(paramId);
					
					var funcBtn = '<div class="action-buttons">';
					var editBtn = '<a class="blue" href="javascript:_edit(&quot;'+paramId+'&quot;)"><i class="icon-search bigger-130"></i>查看</a>';
					//var sort = '<a class="blue" href="javascript:_sort(&quot;'+paramId+'&quot;,&quot;'+paramIds+'&quot;)"><i class="icon-sort bigger-130" aria-hidden="true"></i>升序</a>';
					
					funcBtn += editBtn+'</div>';
	         		$(grid_user).setRowData(paramId, {func: funcBtn});
	         		
	      		}
				//_search();
			}
			
		
			
			
			
			
			
			
			
			function _search(){
				var goodsName = $("#goodsName").val().trim();
				
				var goodsSorts = $("#goodsSorts").val().trim();
				var status = $("#status").val().trim();
				var datestart ="";
				var dateend ="";
				
				if(goodsName.trim().length>32){
					alert("商品名称最多只有输入32个字符");
					$("#goodsName").val("");
					return;
				}
				
				
				if($("#datestart").val()!=""){
					var datestart =new Date($("#datestart").val().trim()).Format("yyyy-MM-dd hh:mm:ss");
					
				}
				if($("#dateend").val()!=""){
					var dateend =new Date($("#dateend").val().trim()).Format1("yyyy-MM-dd hh:mm:ss");
				}
			
				$.setPostData(grid_user, {name: goodsName,goodsSortId:goodsSorts,status: status,  fromTime: datestart, stopTime: dateend});
			    $.refresh(grid_user);
			}
			
			function _sort(id,ids){
				//alert(id+ids);
				/*if(id == ids){
					
				}*/
			var person  = {
				downId:id,
				upId:ids
			}
				
				
			$.ajax({
					type:"get",
					url:$base_path+"manage/ad/exchangeOrder", 
					async:true,
					data:person,
					beforeSend: function(request) {
                        request.setRequestHeader("token", sessionStorage.getItem("token"));
               		 },
					
					success:function(data){
						if(data.code==200){
							alert("修改成功");
							$.refresh(grid_user);	
						}else if(data.code==1403){
							overTime();
						}else{
							//alert(data.msg);
						}
						
					}, 
					error:function(data){ 
						alert("服务器跑丢了......");
					} 
					
			});
				
			
				
				
			}
			
			
			
			function add(){
				_edit('');
				
				
				
				
				$("#form_title").html('添加ep商品');
				$("#tr_pwd").show(); 
				//$("#mu_pwd").attr('ignore', ''); 
				$("#msgspan").text('');
				$("#icon").prop("src","/enjoyRedEnvelopeManager/image/logoImg.png");
				$("#name").val('');
			 	$("#price").val('');
			 	$("#detail").val('');
			 	$("#drawPrice").val('');
			 	$("#drawNum").val('');
			 	$("#stock").val('');
			 	$("#detail").val('');
			 	$("#remark").val('');
			 	$("#goodsSortId").val("");
			 	$("#up").prop("checked","checked");
				$.show("edit_user");
			}
			function beforeDel(){
				var ids = $(grid_user).getGridParam('selarrrow');
				if(ids == ''){
					$.reminderDailog("div_dialog", '<i class="icon-warning-sign"></i>警告', '请选中行!');
				}else{
					$.openDelDailog("div_dialog", del);
				}
			}
			function del(){
				
				
				
				
				
				
				var ids = $(grid_user).getGridParam('selarrrow');
				//alert(ids);
				if($('#div_dialog').html() != ''){
					$.ajax({
				        type: 'POST',
				        url: $base_path + 'manage/goods/down',
				        data: 'goodsId=' + ids,
				        beforeSend: function(request) {
	                        request.setRequestHeader("token", sessionStorage.getItem("token"));
	               		},
				        success: function(data) {
				        	if(data.code==200){
								$.refresh(grid_user);
								$.closeDelDailog();
					          	alert('删除成功！');
					       	}else{					       		
								//alert(data.msg);
								if(data.code==-2)//跳转到登录页面
									top.location.href='/enjoyRedEnvelopeManager/html/login.html';
					       	}
				        }
				    });
			   }
			}
			
			function _edit(id){
				
				if(id==""){
					$("#id").val("");
					$("#icon").prop("src","/enjoyRedEnvelopeManager/image/logoImg.png");
		        	$("#icon2").prop("src","/enjoyRedEnvelopeManager/image/logoImg.png");
		        	$("#icon3").prop("src","/enjoyRedEnvelopeManager/image/logoImg.png");
		        	$("#icon4").prop("src","/enjoyRedEnvelopeManager/image/logoImg.png");
		        	$("#icon5").prop("src","/enjoyRedEnvelopeManager/image/logoImg.png");
		        	$("#icon6").prop("src","/enjoyRedEnvelopeManager/image/logoImg.png");
					
				}else{
					$("#icon").prop("src","/enjoyRedEnvelopeManager/image/logoImg.png");
		        	$("#icon2").prop("src","/enjoyRedEnvelopeManager/image/logoImg.png");
		        	$("#icon3").prop("src","/enjoyRedEnvelopeManager/image/logoImg.png");
		        	$("#icon4").prop("src","/enjoyRedEnvelopeManager/image/logoImg.png");
		        	$("#icon5").prop("src","/enjoyRedEnvelopeManager/image/logoImg.png");
		        	$("#icon6").prop("src","/enjoyRedEnvelopeManager/image/logoImg.png");
		
					
					//alert(id);title  mu_rank
					//$("#mu_img1").val(""); 
					$("#form_title").html('查看ep商品详情');
					$("#msgspan").text(''); 
					
					var model = $(grid_user).getRowData(id); 
					$("#adImg").val(model.icon); 
					$("#id").val(model.id);
					//$("#mu_img").attr("src",$downImg+res.result);
					$("#icon").attr("src",model.icon);
					//$("#image").attr("src",model.icon);
					$("#name").val(model.name);
					$("#detail").val(model.detail);
					$("#price").val(model.price); 
					$("#stock").val(model.stock); 
					$("#drawPrice").val(model.drawPrice);
					$("#drawNum").val(model.drawNum);
					$("#createTime").val(model.createTime);
					$("#remark").val(model.remark);
					
					
					
					$.ajax({
				        type: 'POST',
				        url: $base_path + 'manage/goods/detail',
				        data: 'goodsId=' + model.id,
				        beforeSend: function(request) {
	                        request.setRequestHeader("token", sessionStorage.getItem("token"));
	               		},
				        success: function(data) {
				        	if(data.code==200){
				        		/* $("#icon").prop("src","/enjoyRedEnvelopeManager/image/logoImg.png");
					        	$("#icon2").prop("src","/enjoyRedEnvelopeManager/image/logoImg.png");
					        	$("#icon3").prop("src","/enjoyRedEnvelopeManager/image/logoImg.png");
					        	$("#icon4").prop("src","/enjoyRedEnvelopeManager/image/logoImg.png");
					        	$("#icon5").prop("src","/enjoyRedEnvelopeManager/image/logoImg.png");
					        	$("#icon6").prop("src","/enjoyRedEnvelopeManager/image/logoImg.png");*/
				        		
				        		
				        		
								for(var i =  1;i<=data.result.urls.length;i++){
									var str = "#icon"+i;
									var str1 = "#iconId"+i;
									if(i==1){
										$("#icon").prop("src",data.result.urls[i-1]);
										$("#icon").prop("title",data.result.iconId[i-1]);
										if("0"== data.result.urls[i-1]){
											$("#icon").prop("src","/enjoyRedEnvelopeManager/image/logoImg.png");
										}
										//$("#iconId").html(data.result.iconId[i-1]);
									}else{
										$(str).prop("src",data.result.urls[i-1]);
										
										if("0" == data.result.urls[i-1]){
											$(str).prop("src","/enjoyRedEnvelopeManager/image/logoImg.png");
										}
										
										$(str).prop("title",data.result.iconId[i-1]);
										//$(str).html(data.result.iconId[i-1]);
									}
									
									
									
								}
								$("#editor-trigger").html(data.result.detail.detail);
								
								
								/*for(var i = 0 ;i<$(".ions").length;i++){
									 console.log("detail"+$(".ions")[i].title);	
									
								}*/
								

								
								
					       	}else{
					       		overTime();
								//alert(data.msg);
								
					       	}
				        }
				    });
					
					
					
					
					
					
					//$("#goodsSortId").val(model.goodsSortId);
					$("#goodsSortId").val(model.goodsSortId);
					//alert(model.goodsSortId);
					if(model.status==1){
						$("#up").prop("checked","checked");
					}else{
						$("#down").prop("checked","checked");
					}
				}
				
				$.show("edit_user");
				
				
			}
			
			//重置
			function resetForm(){
				var muId=$("#id").val();
				
				if(muId == ''){
					_edit(muId);
					
					$("#form_title").html('添加商品');
					$("#tr_pwd").show(); 
					$("#msgspan").text('');
					$("#uploadImg").prop("src","/enjoyRedEnvelopeManager/image/logoImg.png");
					$("#name").val('');
				 	$("#price").val('');
				 	$("#detail").val('');
				 	$("#drawPrice").val('');
				 	$("#drawNum").val('');
				 	$("#detail").val('');
				 	$("#remark").val('');
				 	$("#goodsSortId").val("");
				 	$("#up").prop("checked","checked");
				}else{
					_edit(muId);
					$("#form_title").html('编辑商品');
					$("#msgspan").text('');
					//$("#tr_pwd").hide(); 
					$("#mu_pwd").attr('ignore', 'ignore');
					//$("#msgspan").text('');

				 	//$("#up").prop("checked","checked");
				}
			}
			
			
			function closeForm1(){
				for(var i = 0 ;i<$(".ions").length;i++){
					$(".ions")[i].title = "";	
									
				}
				$.hide("edit_user");
				
			}
			
			
			//提交编辑表单
			function edit_submit(){
			  //$("#goodsSortId").val($("#goodsSortIdNo").val());
				//alert("fuck");
				
				//alert(cho);
				
				//form+="&saleSwitch="+;
				var keys = new Array();
				var values = new Array();
				//alert(form);
				//console.log(JSON.stringify));
				//alert($(".ions").length);
				
				for(var i = 0 ;i<$(".ions").length;i++){
					
					if($(".ions")[i].title.length>0){
						keys.push($(".ions")[i].title);	
						
					}else{
						keys.push("0");
					}
					if($(".ions")[i].src.indexOf("/enjoyRedEnvelopeManager/image/logoImg.png")>0){
						
						
						values.push("0");
					}else{
						values.push($(".ions")[i].src);
					}
					
					 
				}
			
				
				
				
				
				
				var id = $("#id").val();
				
				var obj = {
					id:$("#id").val(),
					price:$("#price").val(),
					name:$("#name").val(),
					stock:$("#stock").val(),
					detail:$("#editor-trigger").html(), 
					icons:values,
					goodsSortId:$("#goodsSortId2").html()
				}
				
				
				var obj1  = {
					id:$("#id").val(),
					price:$("#price").val(),
					name:$("#name").val(),
					stock:$("#stock").val(),
					detail:$("#editor-trigger").html(), 
					icons:values,
					iconKey:keys,
					goodsSortId:$("#goodsSortId2").html()
					
				}
				
				
				//alert($("#detail").val().length);
				//alert(JSON.stringify(obj1));
				//console.log(JSON.stringify(obj1));
				//alert(imgs[imgs.length-1]);
				$.ajax({
			        type: 'POST',
			        url: $base_path + (id == '' ? 'manage/goods/addgoodEps' : 'manage/goods/update'),
			        beforeSend: function(request) {
			        	
                       	request.setRequestHeader("token", sessionStorage.getItem("token"));
               		},
               		contentType: "application/json",
               		
               		data: (id == '' ? JSON.stringify(obj): JSON.stringify(obj1))   ,
			        success: function(data) {
			        	
			        	keys.splice(0,keys.length);
			        	imgs.splice(0,imgs.length);
			        	
			        	for(var i = 0 ; i<$(".ions").length;i++){
			        		$(".ions")[i].title = "";
			        		
			        	}
			        	
			        	
			        	
			        	if(data.code == 200){
						    $.hide("edit_user");
						    $.refresh(grid_user);
						    if(id == ''){
						    	alert("添加成功");
						    }else{
						    	alert("修改成功");	
						    }
						    $("#id").val("");
						    $("#icon").prop("src","/enjoyRedEnvelopeManager/image/logoImg.png");
				        	$("#icon2").prop("src","/enjoyRedEnvelopeManager/image/logoImg.png");
				        	$("#icon3").prop("src","/enjoyRedEnvelopeManager/image/logoImg.png");
				        	$("#icon4").prop("src","/enjoyRedEnvelopeManager/image/logoImg.png");
				        	$("#icon5").prop("src","/enjoyRedEnvelopeManager/image/logoImg.png");
				        	$("#icon6").prop("src","/enjoyRedEnvelopeManager/image/logoImg.png");
						    
			        	}else if(data.code==1403){
							overTime();
			        	}else{
			        		alert(data.msg);
			        	}
			        	
			        	
			        	
			        	
			        },
			    });

								
			
				
				
				
			}
	
			//是否禁用
			function _disable(id, v){
				
				var tishi="";
				
				if(v == 1){
					tishi="是否禁用该幻灯片";
				}else if(v == 0){
					tishi="是否解除该禁用幻灯片";
				}
				
				if(confirm(tishi)){
					$.ajax({
				        type: 'POST',
				        url: $base_path + 'ManagerUser/editSysManUser',
				        data: 'muId=' + id + '&muIsDisable=' + v + '&token=' + token, 
				        success: function(data) {
				        	if(data.code==0)
				           		alert(v == 1 ? '已禁用！' : '禁用已解除.');
				           	else{
				        		alert(data.msg);
								if(data.code==-2)//跳转到登录页面
									top.location.href='/enjoyRedEnvelopeManager/html/login.html';			           			
			           		}
				        }
				    });
				    $.refresh(grid_user);
				}
				
			    $.refresh(grid_user);
			}
			
			//重置密码
			function _reset(id){
				if(confirm("是否重置密码")){
					$.ajax({
				        type: 'POST',
				        url: $base_path + 'ManagerUser/resetSysManUserPwd',
				        data: 'muId=' + id + '&token=' + token, 
				        success: function(data) {
				        	if(data.code==0)
				           		alert('密码重置成功！');
				           	else{
				        		alert(data.msg);
								if(data.code==-2)//跳转到登录页面
									top.location.href='/enjoyRedEnvelopeManager/html/login.html';				           		
				           	}
				        }
				    });					
				}
			}
		
		</script>
	</head>
	<body>
		
		<div>
			<table id="grid_user"></table>
			<div id="grid_pager_user"></div>
		</div>
		<div id="grid_user_tbar" style="display:none;">
			<div class="action-buttons" style="margin-left: 10px; padding: 5px;">
				商品名称: <input id="goodsName" onblur="_search()"/>
				商品属性: <select id="goodsSorts" onblur="_search()">
						
					</select>
				类型: <select id="status" onblur="_search()">
						<option value="">全部</option>
						<option value="0" >下架商品</option>
						<option value="1" selected="selected" >上架商品</option>
					 </select>
				日期: <input id="datestart" type="date" onblur="_search()"/>至<input type="date" id="dateend" onblur="_search()"/>
				<a class="blue" href="javascript:_search()"><i class="icon-search bigger-130"></i>查询</a>
			</div>
		</div>
		
		<!-- 编辑商品信息窗口 -->
		<form id="edit_user" class="grid_from checkform" style="width: 800px; height:850px;">
			<div class="widget-header">
				<h4 id="form_title">商品信息</h4>
				<span class="widget-toolbar">
					<a href="#" data-action="close" onclick="closeForm1()">
						<i class="icon-remove"></i>
					</a>    
				</span>
			</div>
			<div class="form_content">
				<input type="hidden" id="id" name="id"/>
				<div class="form_content_table">
					<span id="msgspan" style="color:red;"></span>
					<table>
						<!--<form id="uploadform" >-->
						
						<tr>
							<td></td>
							<td><div class="container" style="width: 150px;"></div></td>
						</tr> 
						<!--</form>-->
						<tr>
							<td >
							</td>
							<td id="image"><img class="ions" style="width: 120px;height: 120px;" title="" src="/enjoyRedEnvelopeManager/image/logoImg.png" id="icon"></td>
							<td id="image2"><img class="ions" style="width: 120px;height: 120px; margin-right: 100px;" title="" src="/enjoyRedEnvelopeManager/image/logoImg.png" id="icon2"></td>
							<td id="image3"><img class="ions" style="width: 120px;height: 120px;" title="" src="/enjoyRedEnvelopeManager/image/logoImg.png" id="icon3"></td>
						</tr>
						
						<tr>
							<td>
							</td>
							<td><input type="file" style="width: 66px;" id="fileImg"  accept="images/*"></td>
							<td><input type="file" style="width: 66px;" id="fileImg2"  accept="images/*"></td>
							<td><input type="file" style="width: 66px;" id="fileImg3"  accept="images/*"></td>
						</tr>
						<tr>
							<td><input type="hidden" name="icon" id="adImg"></td>
							<td id="image4"><img class="ions" title="" style="width: 120px;height: 120px;" src="/enjoyRedEnvelopeManager/image/logoImg.png" id="icon4"></td>
							<td id="image5"><img class="ions"  title="" style="width: 120px;height: 120px; margin-right: 100px;" src="/enjoyRedEnvelopeManager/image/logoImg.png" id="icon5"></td>
							<td id="image6"><img class="ions"  title="" style="width: 120px;height: 120px;" src="/enjoyRedEnvelopeManager/image/logoImg.png" id="icon6"></td>
						</tr>
						<tr>
							<td></td>
							<td><input type="file" style="width: 66px;" id="fileImg4" accept="images/*"></td>
							<td><input type="file" style="width: 66px;" id="fileImg5" accept="images/*"></td>
							<td><input type="file" style="width: 66px;" id="fileImg6" accept="images/*"></td>
						</tr>
						<tr>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td>商品名称</td>
							<td><input type="text" id="name" name="name" placeholder="商品名称" datatype="s1-18" nullmsg="请输入商品名称" errormsg="商品名称有误" /></td>
							<td colspan="2" style="padding-left: 40px;">商品价格<input type="text"  id="price" name="price" placeholder="商品价格" datatype="n1-8" nullmsg="请输入商品价格！" errormsg="商品价格输入有误"/></td>
							
						</tr>
						
						<tr id="tr_pwd">
							<td id="goodsSortId2" style="display: none;"></td>
						</tr>
						<tr>
							<td>商品库存</td>
							<td><input type="text"  id="stock" name="stock" placeholder="商品库存" datatype="n1-8" nullmsg="请输入商品库存！" errormsg="商品库存输入有误"/></td>
							<!--<td colspan="2" style="padding-left: 40px;">商品属性<select id="goodsSortId" name="goodsSortId" autocomplete="off">			
							</select></td>-->
							<td colspan="2" style="padding-left: 40px;">商品属性<input type="text" placeholder="ep兑换" disabled="disabled"></td>
							
						</tr>
						<tr>
								
								
						</tr>
						<!--<tr>
							<td>商品介绍</td>
							
							<td colspan="3"><textarea style="width: 600px;height: 70px;"  id="detail" name="detail" placeholder="商品介绍" datatype="s1-2000" nullmsg="请输入商品介绍" errormsg="商品介绍有误"></textarea></td>
						</tr>-->
						
						
						<tr>
							<td>商品介绍</td>
							
							<td colspan="3" >
								 <div id="editor-container" >
							        <div id="editor-trigger"><p>请输入内容</p></div>
							        <!-- <textarea id="editor-trigger" style="display:none;">
							            <p>请输入内容...</p>
							        </textarea> -->
							    </div>
							
							</td>
						</tr>
						
						
						
						
					</table>
					
					
					
				</div>
				<div>
					<button class="btn btn-info button-left" type="submit">
						<i class="icon-ok bigger-110"></i>
						提交
					</button>
					<button class="btn button-right" type="button" onclick="resetForm()">
						<i class="icon-undo bigger-110"></i>
						重置
					</button>
				</div>
			</div>
		</form>
		
		<div id="div_dialog"></div>
		<div id="hidebg"></div>
	</body>
	<script type="text/javascript">
		
			var type=0;
			var imgs = new Array() ; 
		
			var src1 = "";
			var swidth = 720;
			var tmp = $('<div class="resizer">' +

				'<div class="inner">' +

				'<img style="100%">' +

				'<div class="frames"></div>' +

				'</div>' +

				//'<button>&#10007;</button>'+

				'<button type="button" class="ok">&#10003;</button>' +

				'</div>');

			$.imageResizer = function() {

				if(Uint8Array && HTMLCanvasElement && atob && Blob) {

				} else {

					return false;

				}

				var resizer = tmp.clone();

				resizer.image = resizer.find('img')[0];

				resizer.frames = resizer.find('.frames');

				resizer.okButton = resizer.find('button.ok');

				resizer.frames.offset = {

					top: 0,

					left: 0

				};

				resizer.okButton.click(function() {

					resizer.clipImage();
					$(".container").hide();
					//alert(document.getElementsByName("inner").innerHTML);
					//alert(src1); image
					var bucket1 = "";
					if($qiniu_root ==1){
						bucket1 = "doupai-offical-goods";
						
					}else{
						bucket1 = "doupai-test-goods";
					}
					var person = {
						bucket:bucket1
					}
					
					
					
					
					
					var base64 = src1.split("base64,")[1];
					$.ajax({
								type:"post",
								url:$base_path+"manage/common/uptoken", 
								data:person,
								success:function(data){
									if(data.code==200){
										var pic = base64 ;
									    var url = "http://upload-z2.qiniu.com/putb64/-1"; //非华东空间需要根据注意事项 1 修改上传域名
									    var xhr = new XMLHttpRequest();
									 	
										xhr.onreadystatechange=function(){
										    if (xhr.readyState==4){
										    	
										      //document.getElementById("myDiv").innerHTML=data.result.domain+JSON.parse(xhr.responseText).hash;  
										   	  src1 = data.result.domain+JSON.parse(xhr.responseText).hash;
										   	    if(type ==1){
													$("#icon").prop("src",src1);
													
													
													//$("#adImg").val(src1);
												}else if(type == 2){
													$("#icon2").prop("src",src1);
													//$("#adImg").val(src1);
												}else if(type == 3){
													$("#icon3").prop("src",src1);
													//$("#adImg").val(src1);
												}else if(type == 4){
													$("#icon4").prop("src",src1);
													//$("#adImg").val(src1);
												}else if(type == 5){
													$("#icon5").prop("src",src1);
													//$("#adImg").val(src1);
												}else if(type == 6){
													$("#icon6").prop("src",src1);
													//$("#adImg").val(src1);
												}
												
												
													imgs.push(src1);
										   	  
										   	
										    }
										}
									  	xhr.open("POST", url, true);
									  	xhr.setRequestHeader("Content-Type", "application/octet-stream");
									  	xhr.setRequestHeader("Authorization", "UpToken "+data.result.token);
									  	xhr.send(pic);
									  	
									  	
									  	
									  	
									  	
									  	
									}else{
										alert(data.msg);
									}
									
									
								}, 
								error:function(data){ 
								} 					
					});
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					//$("#adImg").val(imgs);
					//console.log(imgs.length);
					//$("#image").html(src1);
					//$("#icon").prop("src",src1);
					//$("#adImg").val(src1);
					//alert($("#icon").prop("src"));
					
						
				});

				resizer.clipImage = function() {

					var nh = this.image.naturalHeight,

						nw = this.image.naturalWidth,

						size = nw > nh ? nh : nw;

					//size=size>1000?1000:size;
					size = swidth;
					
					var canvas = $('<canvas width="' + size + '" height="' + size + '"></canvas>')[0],

						ctx = canvas.getContext('2d'),

						scale = nw / this.offset.width,

						x = this.frames.offset.left * scale,

						y = this.frames.offset.top * scale,

						w = this.frames.offset.size * scale,

						h = this.frames.offset.size * scale;

					ctx.drawImage(this.image, x, y, w, h, 0, 0, size, size);

					var src = canvas.toDataURL("image/png", 0.5);
					//alert(src.length);
					//console.log(src);
					src1 = src;
					
					this.canvas = canvas;

					this.append(canvas);

					this.addClass('uploading');

					this.removeClass('have-img');

					src = src.split(',')[1];

					if(!src) return this.doneCallback(null);

					src = window.atob(src);

					var ia = new Uint8Array(src.length);

					for(var i = 0; i < src.length; i++) {

						ia[i] = src.charCodeAt(i);

					};

					this.doneCallback(new Blob([ia], {
						type: "image/png"
					}));
					
					

				};

				resizer.resize = function(file, done) {

					this.reset();

					this.doneCallback = done;

					this.setFrameSize(0);

					this.frames.css({

						top: 0,

						left: 0

					});

					var reader = new FileReader();

					reader.onload = function() {

						resizer.image.src = reader.result;

						reader = null;

						resizer.addClass('have-img');

						resizer.setFrames();

					};

					reader.readAsDataURL(file);

				};

				resizer.reset = function() {

					this.image.src = '';

					this.removeClass('have-img');

					this.removeClass('uploading');

					this.find('canvas').detach();

				};

				resizer.setFrameSize = function(size) {

					this.frames.offset.size = size;

					return this.frames.css({

						width: size + 'px',

						height: size + 'px'

					});

				};

				resizer.getDefaultSize = function() {

					var width = this.find(".inner").width(),

						height = this.find(".inner").height();

					this.offset = {

						width: width,

						height: height

					};

					//console.log(this.offset)

					return width > height ? height : width;

				};

				resizer.moveFrames = function(offset) {

					var x = offset.x,

						y = offset.y,

						top = this.frames.offset.top,

						left = this.frames.offset.left,

						size = this.frames.offset.size,

						width = this.offset.width,

						height = this.offset.height;

					if(x + size + left > width) {

						x = width - size;

					} else {

						x = x + left;

					};

					if(y + size + top > height) {

						y = height - size;

					} else {

						y = y + top;

					};

					x = x < 0 ? 0 : x;

					y = y < 0 ? 0 : y;

					this.frames.css({

						top: y + 'px',

						left: x + 'px'

					});

					this.frames.offset.top = y;

					this.frames.offset.left = x;

				};

				(function() {

					var time;

					function setFrames() {

						var size = resizer.getDefaultSize();

						resizer.setFrameSize(size);

					};

					window.onresize = function() {

						clearTimeout(time)

						time = setTimeout(function() {

							setFrames();

						}, 1000);

					};

					resizer.setFrames = setFrames;

				})();

				(function() {

					var lastPoint = null;

					function getOffset(event) {

						event = event.originalEvent;

						var x, y;

						if(event.touches) {

							var touch = event.touches[0];

							x = touch.clientX;

							y = touch.clientY;

						} else {

							x = event.clientX;

							y = event.clientY;

						}

						if(!lastPoint) {

							lastPoint = {

								x: x,

								y: y

							};

						};

						var offset = {

							x: x - lastPoint.x,

							y: y - lastPoint.y

						}

						lastPoint = {

							x: x,

							y: y

						};

						return offset;

					};

					resizer.frames.on('touchstart mousedown', function(event) {

						getOffset(event);

					});

					resizer.frames.on('touchmove mousemove', function(event) {

						if(!lastPoint) return;

						var offset = getOffset(event);

						resizer.moveFrames(offset);

					});

					resizer.frames.on('touchend mouseup', function(event) {

						lastPoint = null;

					});

				})();

				return resizer;

			};

			var resizer = $.imageResizer(),

				resizedImage;

			if(!resizer) {

				resizer = $("<p>Your browser doesn't support these feature:</p><ul><li>canvas</li><li>Blob</li><li>Uint8Array</li><li>FormData</li><li>atob</li></ul>")

			};

			$('.container').append(resizer);

			$('input').change(function(event) {
				//alert("test");

				var file = this.files[0];

				resizer.resize(file, function(file) {

					resizedImage = file;

				});

			});
			
			
			
			$("#saveImg").click(function(){
				
				$(".container").hide();
				
				
			  	$("#fileImg").val('');
				//alert(src1);
				//console.log(src1);
			})
			
			$("#fileImg").click(function(){
				type =1;
				$("#fileImg").val('');
				$(".container").show();
			})
			
			$("#fileImg2").click(function(){
				type =2;
				$("#fileImg2").val('');
				$(".container").show();
			})
			$("#fileImg3").click(function(){
				type =3;
				$("#fileImg3").val('');
				$(".container").show();
			})
			$("#fileImg4").click(function(){
				type =4;
				$("#fileImg4").val('');
				$(".container").show();
			})
			$("#fileImg5").click(function(){
				type =5;
				$("#fileImg5").val('');
				$(".container").show();
			})
			$("#fileImg6").click(function(){
				type =6;
				$("#fileImg6").val('');
				$(".container").show();
			})
			
			
			
			
		</script>
		
		<script type="text/javascript">
        // 阻止输出log
        // wangEditor.config.printLog = false;

        var editor = new wangEditor('editor-trigger');

        // 上传图片
        editor.config.uploadImgUrl = '/upload';
        editor.config.uploadParams = {
            // token1: 'abcde',
            // token2: '12345'
        };
        editor.config.uploadHeaders = {
            // 'Accept' : 'text/x-json'
        }
        // editor.config.uploadImgFileName = 'myFileName';

        // 隐藏网络图片
        // editor.config.hideLinkImg = true;

        // 表情显示项
        editor.config.emotionsShow = 'value';
        editor.config.emotions = {
            'default': {
                title: '默认',
                data: './emotions.data'
            },
            'weibo': {
                title: '微博表情',
                data: [
                    {
                        icon: 'http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/7a/shenshou_thumb.gif',
                        value: '[草泥马]'    
                    },
                    {
                        icon: 'http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/60/horse2_thumb.gif',
                        value: '[神马]'    
                    },
                    {
                        icon: 'http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/bc/fuyun_thumb.gif',
                        value: '[浮云]'    
                    },
                    {
                        icon: 'http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/c9/geili_thumb.gif',
                        value: '[给力]'    
                    },
                    {
                        icon: 'http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/f2/wg_thumb.gif',
                        value: '[围观]'    
                    },
                    {
                        icon: 'http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/70/vw_thumb.gif',
                        value: '[威武]'
                    }
                ]
            }
        };

        // 插入代码时的默认语言
        // editor.config.codeDefaultLang = 'html'

        // 只粘贴纯文本
        editor.config.pasteText = true;

        // 跨域上传
           editor.config.uploadImgUrl = 'http://localhost:8020/upload';

        // 第三方上传
        // editor.config.customUpload = true;

        // 普通菜单配置
        // editor.config.menus = [
        //     'img',
        //     'insertcode',
        //     'eraser',
        //     'fullscreen'
        // ];
        // 只排除某几个菜单（兼容IE低版本，不支持ES5的浏览器），支持ES5的浏览器可直接用 [].map 方法
        // editor.config.menus = $.map(wangEditor.config.menus, function(item, key) {
        //     if (item === 'insertcode') {
        //         return null;
        //     }
        //     if (item === 'fullscreen') {
        //         return null;
        //     }
        //     return item;
        // });

        // onchange 事件
        editor.onchange = function () {
            //console.log(this.$txt.html());
        };

        // 取消过滤js
        // editor.config.jsFilter = false;

        // 取消粘贴过来
        // editor.config.pasteFilter = false;

        // 设置 z-index
        // editor.config.zindex = 20000;

        // 语言
        // editor.config.lang = wangEditor.langs['en'];

        // 自定义菜单UI
        // editor.UI.menus.bold = {
        //     normal: '<button style="font-size:20px; margin-top:5px;">B</button>',
        //     selected: '.selected'
        // };
        // editor.UI.menus.italic = {
        //     normal: '<button style="font-size:20px; margin-top:5px;">I</button>',
        //     selected: '<button style="font-size:20px; margin-top:5px;"><i>I</i></button>'
        // };
        editor.create();
		
		/*$("#test").click(function(){
				 alert($("#editor-trigger").html()); 
		
		})*/
		
		

  	
	
	  		
	  		
	 
			
	  	
		
		
		
		
		
    </script>

</html>
